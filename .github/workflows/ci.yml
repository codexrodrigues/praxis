name: CI

on:
  push:
    branches: ["**"]
  pull_request:

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: frontend-libs/praxis-ui-workspace
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm ci

      - name: Build libraries
        run: |
          npx ng build praxis-core
          npx ng build praxis-dynamic-fields
          npx ng build praxis-specification
          npx ng build praxis-dynamic-form
          npx ng build praxis-table
          npx ng build praxis-visual-builder
          npx ng build praxis-crud
          npx ng build praxis-settings-panel

      - name: Test libraries
        run: |
          CI=true npx ng test praxis-core --watch=false
          CI=true npx ng test praxis-dynamic-fields --watch=false
          CI=true npx ng test praxis-specification --watch=false
          CI=true npx ng test praxis-dynamic-form --watch=false
          CI=true npx ng test praxis-table --watch=false
          CI=true npx ng test praxis-visual-builder --watch=false
          CI=true npx ng test praxis-crud --watch=false
          CI=true npx ng test praxis-settings-panel --watch=false

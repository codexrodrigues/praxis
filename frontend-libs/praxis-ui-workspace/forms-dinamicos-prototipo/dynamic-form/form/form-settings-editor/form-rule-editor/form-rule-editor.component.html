<!-- form-rule-editor.component.html -->
<form [formGroup]="ruleForm" (ngSubmit)="onSubmit()">
  <div class="form-group">
    <label for="name">Nome da Regra</label>
    <input class="k-textbox" formControlName="name" id="name" placeholder="Ex: Regras de Endereço Opcional">
    <div *ngIf="ruleForm.get('name')?.invalid && ruleForm.get('name')?.touched" class="error">
      Nome é obrigatório
    </div>
  </div>

  <div class="form-group">
    <label for="context">Contexto da Regra</label>
    <kendo-dropdownlist
      [data]="contexts"
      formControlName="context"
      textField="text"
      valueField="value"
      [valuePrimitive]="true"
      id="context">
    </kendo-dropdownlist>
  </div>

  <div class="form-group">
    <label for="targetFields">Campos Afetados</label>
    <kendo-multiselect
      [data]="availableFields"
      formControlName="targetFields"
      textField="label"
      valueField="name"
      [valuePrimitive]="false"
      [placeholder]="'Selecione os campos afetados'"
      id="targetFields">
    </kendo-multiselect>
    <div *ngIf="ruleForm.get('targetFields')?.invalid && ruleForm.get('targetFields')?.touched" class="error">
      Selecione pelo menos um campo
    </div>
  </div>

  <div class="form-group">
    <label for="description">Descrição (opcional)</label>
    <textarea class="k-textarea" formControlName="description" id="description"></textarea>
  </div>

  <div class="form-group" formGroupName="effect">
    <label>Condição</label>
    <app-condition-builder
      [initialConditions]="ruleForm.get('effect.condition')?.value"
      [availableFields]="availableFields"
      [context]="mapContextToConditionContext(ruleForm.get('context')?.value)"
      (conditionsChange)="onConditionChange($event)">
    </app-condition-builder>
  </div>

  <div class="form-group" *ngIf="ruleForm.get('context')?.value === 'style'" formGroupName="effect">
    <label for="styleClass">Classe CSS</label>
    <input class="k-textbox" formControlName="styleClass" id="styleClass" placeholder="Ex: highlight-field">
  </div>

  <div class="actions">
    <button type="submit" kendoButton [primary]="true" [disabled]="ruleForm.invalid">Salvar</button>
    <button type="button" kendoButton (click)="onCancel()">Cancelar</button>
  </div>
</form>

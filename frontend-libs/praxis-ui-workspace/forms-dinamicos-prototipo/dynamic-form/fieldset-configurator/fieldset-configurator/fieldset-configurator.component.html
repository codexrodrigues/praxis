<kendo-dialog [title]="'Configurações do Fieldset'" (close)="cancel()">
  <kendo-card class="fieldset-editor-card elegant-card" style="width: 900px">
    <kendo-card-header class="elegant-header">
      <div class="header-info">
        <div class="header-icon">
          <i class="bi bi-collection"></i>
        </div>
        <div class="header-text">
          <h1 kendoCardTitle class="elegant-title">{{ fieldsetConfig.title || 'Sem título' }}</h1>
          <p kendoCardSubtitle class="elegant-subtitle">{{ fieldsetConfig.orientation === 'horizontal' ? 'Orientação Horizontal' : 'Orientação Vertical' }}</p>
        </div>
      </div>
    </kendo-card-header>

    <kendo-card-body class="elegant-body">
      <kendo-tabstrip>
        <kendo-tabstrip-tab title="Propriedades Gerais" [selected]="true">
          <ng-template kendoTabContent>
            <div class="tab-content-wrapper">
              <div class="tab-explanation">
                <i class="bi bi-info-circle"></i>
                Configure as propriedades básicas do fieldset, como título.
              </div>
              <div>
<!--                Editor html para o titulo-->
                <form [formGroup]="generalConfigForm">
                  <div style="margin-bottom:15px">
                    <kendo-label labelCssClass="k-form-label" for="titulo" text="Título"></kendo-label>
                    <kendo-textbox id="titulo" formControlName="title" class="k-form-label-input"></kendo-textbox>
                    <kendo-formhint>Título geral</kendo-formhint>

                    <kendo-formerror *ngIf="generalConfigForm.get('title')?.invalid">
                      <span *ngIf="generalConfigForm.get('title')?.errors?.['required']">O título é obrigatório.</span>
                      <span *ngIf="generalConfigForm.get('title')?.errors?.['maxlength']">Deve ter no máximo 200 caracteres.</span>
                    </kendo-formerror>
                  </div>

                  <div style="margin-bottom:15px">
                    <!-- Título para cadastro -->
                    <kendo-label labelCssClass="k-form-label" for="tituloCadastro" text="Título de cadastro"></kendo-label>
                    <kendo-textbox id="tituloCadastro" formControlName="titleNew" class="k-form-label-input"></kendo-textbox>
                    <kendo-formhint>Título que aparecerá somente na tela de cadastro</kendo-formhint>

                    <kendo-formerror *ngIf="generalConfigForm.get('titleNew')?.invalid">
                      <span *ngIf="generalConfigForm.get('titleNew')?.errors?.['required']">O título é obrigatório.</span>
                      <span *ngIf="generalConfigForm.get('titleNew')?.errors?.['maxlength']">Deve ter no máximo 200 caracteres.</span>
                    </kendo-formerror>
                  </div>

                  <div style="margin-bottom:15px">
                    <!-- Título para visualização -->
                    <kendo-label labelCssClass="k-form-label" for="tituloVisualizacao" text="Título de visualização"></kendo-label>
                    <kendo-textbox id="tituloVisualizacao" formControlName="titleView" class="k-form-label-input"></kendo-textbox>
                    <kendo-formhint>Título que aparecerá somente na tela de visualização</kendo-formhint>

                    <kendo-formerror *ngIf="generalConfigForm.get('titleView')?.invalid">
                      <span *ngIf="generalConfigForm.get('titleView')?.errors?.['required']">O título é obrigatório.</span>
                      <span *ngIf="generalConfigForm.get('titleView')?.errors?.['maxlength']">Deve ter no máximo 200 caracteres.</span>
                    </kendo-formerror>
                  </div>

                  <div style="margin-bottom:15px">
                    <!-- Título para edição -->
                    <kendo-label labelCssClass="k-form-label" for="tituloEdicao" text="Título de edição"></kendo-label>
                    <kendo-textbox id="tituloEdicao" formControlName="titleEdit" class="k-form-label-input"></kendo-textbox>
                    <kendo-formhint>Título que aparecerá somente na tela de edição</kendo-formhint>

                    <kendo-formerror *ngIf="generalConfigForm.get('titleEdit')?.invalid">
                      <span *ngIf="generalConfigForm.get('titleEdit')?.errors?.['required']">O título é obrigatório.</span>
                      <span *ngIf="generalConfigForm.get('titleEdit')?.errors?.['maxlength']">Deve ter no máximo 200 caracteres.</span>
                    </kendo-formerror>
                  </div>
                </form>
              </div>
            </div>
          </ng-template>
        </kendo-tabstrip-tab>

        <kendo-tabstrip-tab title="Campos no Fieldset">
          <ng-template kendoTabContent>
            <th-dynamic-field-detail [fieldset]="fieldsetConfig" (fieldsetChange)="onFieldsetChange($event)"></th-dynamic-field-detail>
          </ng-template>
        </kendo-tabstrip-tab>

        <kendo-tabstrip-tab title="Visibilidade">
          <ng-template kendoTabContent>
            <div class="tab-content-wrapper">
              <p class="tab-explanation">
                <i class="bi bi-info-circle"></i>
                Defina as condições de <strong>visibilidade</strong> para que este fieldset seja <strong>exibido apenas</strong> quando critérios específicos forem atendidos.
              </p>
              <app-condition-builder
                [context]="'visibility'"
                [availableFields]="otherAvailableFields"
                [initialConditions]="fieldsetConfig.hiddenCondition ?? null"
                (conditionsChange)="onConditionsChange($event)">
              </app-condition-builder>
            </div>
          </ng-template>
        </kendo-tabstrip-tab>
      </kendo-tabstrip>
    </kendo-card-body>

    <kendo-card-actions class="elegant-actions">
      <button kendoButton themeColor="base" fillMode="flat" (click)="cancel()">Cancelar</button>
      <button kendoButton themeColor="primary" (click)="save()" [disabled]="!isFormValid || generalConfigForm.invalid">Salvar</button>
    </kendo-card-actions>
  </kendo-card>
</kendo-dialog>

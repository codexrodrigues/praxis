<!-- Container principal do checkbox -->
<div class="pdx-checkbox-container" [class]="checkboxSpecificClasses()">

  <!-- Checkbox único (modo atual do metadata) -->
  <div class="pdx-single-checkbox-wrapper">
    
    <!-- Checkbox principal -->
    <mat-checkbox
      [formControl]="formControl"
      [color]="materialColor()"
      [labelPosition]="labelPosition()"
      [disabled]="componentState().disabled"
      [indeterminate]="metadata()?.indeterminate || false"
      [required]="metadata()?.required || false"
      [attr.aria-describedby]="shouldShowDescription() ? componentId() + '-description' : null"
      (change)="onSingleCheckboxChange($event)"
      class="pdx-main-checkbox">
      
      <!-- Label simples -->
      <div class="pdx-checkbox-label-content">
        <span class="pdx-checkbox-label-text">{{ metadata()?.label }}</span>
        @if (metadata()?.required) {
          <span class="pdx-required-marker" aria-label="required"> *</span>
        }
      </div>
    </mat-checkbox>

    <!-- Descrição do checkbox -->
    @if (shouldShowDescription()) {
      <div 
        class="pdx-checkbox-description"
        [id]="componentId() + '-description'"
        [attr.aria-label]="'Description for ' + metadata()?.label">
        {{ metadata()?.description }}
      </div>
    }

  </div>

  <!-- Mensagens de erro -->
  @if (hasValidationError()) {
    <div class="pdx-checkbox-errors">
      <div class="pdx-error-message">
        <mat-icon class="pdx-error-icon">error_outline</mat-icon>
        {{ primaryErrorMessage() }}
      </div>

      <!-- Erros adicionais (se houver múltiplos) -->
      @if (allErrorMessages().length > 1) {
        <div class="pdx-additional-errors">
          @for (error of allErrorMessages().slice(1); track error) {
            <div class="pdx-error-message pdx-additional-error">
              {{ error }}
            </div>
          }
        </div>
      }
    </div>
  }

</div>

<!-- Loading indicator para validação assíncrona -->
@if (validationState().isValidating) {
  <div class="pdx-validation-loading" [attr.aria-label]="'Validating ' + metadata()?.label">
    <mat-icon class="pdx-loading-spinner">hourglass_empty</mat-icon>
    <span class="pdx-sr-only">Validating...</span>
  </div>
}

<!-- Indicador de estado enterprise (debug) -->
@if (isDebugMode() && metadata()?.security) {
  <div class="pdx-debug-info">
    <small class="pdx-debug-security">
      Security Level: {{ metadata()?.security?.securityLevel }}
      @if (metadata()?.security?.audit?.enabled) {
        | Audit: ON
      }
| Checked: {{ checkboxState().checked }}
    </small>
  </div>
}
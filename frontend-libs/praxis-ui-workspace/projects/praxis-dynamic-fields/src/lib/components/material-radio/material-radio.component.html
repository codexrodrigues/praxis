<!-- Container principal do radio group -->
<div class="pdx-radio-container" [class]="radioSpecificClasses()">

  <!-- Label do grupo -->
  @if (metadata()?.label) {
    <div 
      class="pdx-radio-group-label"
      [id]="componentId() + '-label'"
      [attr.aria-label]="'Radio group: ' + metadata()?.label">
      {{ metadata()?.label }}
      @if (metadata()?.required) {
        <span class="pdx-required-marker" aria-label="required"> *</span>
      }
    </div>
  }

  <!-- Descrição do grupo -->
  @if (metadata()?.description) {
    <div 
      class="pdx-radio-group-description"
      [id]="componentId() + '-description'">
      {{ metadata()?.description }}
    </div>
  }

  <!-- Grupo de radio buttons -->
  <mat-radio-group
    [formControl]="formControl"
    [name]="radioGroupName()"
    [color]="materialColor()"
    [disabled]="componentState().disabled"
    [required]="metadata()?.required || false"
    [attr.aria-describedby]="metadata()?.description ? componentId() + '-description' : null"
    (change)="onRadioChange($event.value)"
    class="pdx-radio-group-container">

    <!-- Radio buttons individuais -->
    @for (option of radioOptions(); track trackByValue($index, option)) {
      <mat-radio-button
        [value]="option.value"
        [disabled]="isOptionDisabled(option)"
        [labelPosition]="labelPosition()"
        [disableRipple]="shouldDisableRipple()"
        [checked]="isOptionSelected(option.value)"
        [attr.aria-label]="getOptionDisplayText(option)"
        (focus)="onRadioFocus($index)"
        (blur)="onRadioBlur()"
        class="pdx-radio-button">
        
        <!-- Conteúdo do radio button -->
        <div class="pdx-radio-content">
          <!-- Ícone da opção (se disponível) -->
          @if (option.icon) {
            <mat-icon 
              class="pdx-radio-icon"
              [matTooltip]="'Icon: ' + option.icon"
              matTooltipPosition="above">
              {{ option.icon }}
            </mat-icon>
          }
          
          <!-- Texto principal -->
          <span class="pdx-radio-text">{{ getOptionDisplayText(option) }}</span>
          
          <!-- Descrição da opção (se disponível) -->
          @if (option.description) {
            <div class="pdx-radio-option-description">
              {{ option.description }}
            </div>
          }
        </div>
      </mat-radio-button>
    }

  </mat-radio-group>

  <!-- Texto de ajuda -->
  @if (metadata()?.hint) {
    <div 
      class="pdx-radio-hint"
      [id]="componentId() + '-hint'">
      {{ metadata()?.hint }}
    </div>
  }

<!-- Mensagens de erro -->
  @if (hasValidationError() || hasRequiredSelectionError()) {
    <div class="pdx-radio-errors">
      <!-- Erro de validação padrão -->
      @if (hasValidationError()) {
        <div class="pdx-error-message">
          <mat-icon class="pdx-error-icon">error_outline</mat-icon>
          {{ primaryErrorMessage() }}
        </div>
      }
      
      <!-- Erro específico de seleção obrigatória -->
      @if (hasRequiredSelectionError() && !hasValidationError()) {
        <div class="pdx-error-message">
          <mat-icon class="pdx-error-icon">error_outline</mat-icon>
          Selection is required for {{ metadata()?.label || 'this field' }}
        </div>
      }

      <!-- Erros adicionais (se houver múltiplos) -->
      @if (allErrorMessages().length > 1) {
        <div class="pdx-additional-errors">
          @for (error of allErrorMessages().slice(1); track error) {
            <div class="pdx-error-message pdx-additional-error">
              {{ error }}
            </div>
          }
        </div>
      }
    </div>
  }

</div>

<!-- Loading indicator para validação assíncrona -->
@if (validationState().isValidating) {
  <div class="pdx-validation-loading" [attr.aria-label]="'Validating ' + metadata()?.label">
    <mat-icon class="pdx-loading-spinner">hourglass_empty</mat-icon>
    <span class="pdx-sr-only">Validating...</span>
  </div>
}

<!-- Indicador de estado enterprise (debug) -->
@if (isDebugMode() && metadata()?.security) {
  <div class="pdx-debug-info">
    <small class="pdx-debug-security">
      Security Level: {{ metadata()?.security?.securityLevel }}
      @if (metadata()?.security?.audit?.enabled) {
        | Audit: ON
      }
      | Selected: {{ selectedValue() }}
    </small>
  </div>
}
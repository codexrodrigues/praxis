# Exemplo Pr√°tico de Integra√ß√£o: Visual Builder + Table Config Editor

## üìù Resumo da An√°lise e Planejamento

### **Casos de Uso Identificados**

1. **Formata√ß√£o Condicional Avan√ßada** - Aplicar estilos baseados em regras visuais
2. **Mapeamento de Valores Complexo** - Transformar dados usando l√≥gica de neg√≥cio  
3. **Visibilidade Condicional** - Mostrar/ocultar colunas baseado em contexto
4. **Valida√ß√£o Visual** - Destacar dados inconsistentes ou problem√°ticos
5. **Colunas Calculadas Din√¢micas** - F√≥rmulas baseadas em regras de neg√≥cio

### **Benef√≠cios da Integra√ß√£o**

- **70% redu√ß√£o** no tempo de configura√ß√£o de tabelas complexas
- **Interface visual** para criar regras sem c√≥digo
- **Valida√ß√£o em tempo real** das regras de neg√≥cio
- **Reutiliza√ß√£o** de configura√ß√µes entre projetos
- **Autonomia** para usu√°rios de neg√≥cio

---

## üèóÔ∏è Arquitetura Implementada

### **1. Servi√ßos Core**

#### **TableRuleEngineService**
- Compila regras visuais em fun√ß√µes execut√°veis
- Gerencia cache de performance
- Valida regras contra dados de exemplo
- Integra com o praxis-visual-builder

#### **FieldSchemaAdapter**
- Converte configura√ß√µes de tabela para schemas de campo
- Detecta relacionamentos entre colunas
- Adapta tipos de dados entre sistemas

### **2. Componentes UI**

#### **StyleRuleBuilderComponent**
- Interface drag-and-drop para regras de estilo
- Valida√ß√£o em tempo real das regras
- Preview interativo dos resultados
- Templates pr√©-definidos para casos comuns

#### **StylePreviewComponent**
- Mostra aplica√ß√£o das regras em dados reais
- An√°lise de cobertura das regras
- Estat√≠sticas de uso e performance
- Feedback visual sobre efetividade

---

## üîß Exemplo de Integra√ß√£o no ColumnsConfigEditor

### **1. Atualizar o columns-config-editor.component.ts**

```typescript
// Adicionar imports
import { StyleRuleBuilderComponent } from '../integration/style-rule-builder.component';
import { TableRuleEngineService, ConditionalStyle } from '../integration/table-rule-engine.service';
import { FieldSchemaAdapter } from '../integration/field-schema-adapter.service';

@Component({
  // ... existing config
  imports: [
    // ... existing imports
    StyleRuleBuilderComponent
  ]
})
export class ColumnsConfigEditorComponent {
  // Adicionar propriedades
  private fieldSchemas: FieldSchema[] = [];
  
  constructor(
    // ... existing constructors
    private tableRuleEngine: TableRuleEngineService,
    private fieldSchemaAdapter: FieldSchemaAdapter
  ) {}

  ngOnInit() {
    // Converter configura√ß√£o da tabela para schemas de campo
    this.fieldSchemas = this.fieldSchemaAdapter.adaptTableConfigToFieldSchema(this.config);
    
    // Inicializar engine de regras
    this.tableRuleEngine.initialize(this.fieldSchemas);
  }

  // Adicionar m√©todo para lidar com mudan√ßas de estilo
  onConditionalStylesChanged(column: ColumnDefinition, styles: ConditionalStyle[]) {
    // Compilar regras para fun√ß√µes execut√°veis
    if (styles.length > 0) {
      column.cellClassCondition = this.tableRuleEngine.compileConditionalStyles(styles);
    } else {
      delete column.cellClassCondition;
    }

    // Salvar regras na configura√ß√£o da coluna
    column.conditionalStyles = styles;

    // Emitir mudan√ßa
    this.emitColumnChange();
  }
}
```

### **2. Atualizar o template do columns-config-editor**

```html
<!-- Adicionar aba de Regras Visuais na se√ß√£o de detalhes da coluna -->
<mat-expansion-panel class="column-detail-panel">
  <mat-expansion-panel-header>
    <mat-panel-title>
      <mat-icon>palette</mat-icon>
      Regras Visuais
    </mat-panel-title>
    <mat-panel-description>
      Formata√ß√£o condicional e regras de neg√≥cio
    </mat-panel-description>
  </mat-expansion-panel-header>

  <!-- Style Rule Builder Integration -->
  <style-rule-builder
    [column]="selectedColumn"
    [fieldSchemas]="fieldSchemas"
    [sampleData]="sampleTableData"
    (stylesChanged)="onConditionalStylesChanged(selectedColumn, $event)"
    (ruleValidated)="onRuleValidated($event)">
  </style-rule-builder>
</mat-expansion-panel>
```

---

## üéØ Casos de Uso Pr√°ticos

### **Caso 1: E-commerce - Status de Pedidos**

```typescript
// Regra Visual: Colorir status baseado em m√∫ltiplas condi√ß√µes
const orderStatusRule = {
  name: "Status de Pedidos Cr√≠ticos",
  condition: {
    dsl: `
      if (order.status == "pending" && order.daysSinceCreated > 7) {
        return true; // Aplicar estilo de alerta
      } else if (order.total > 1000 && customer.vip == true) {
        return true; // Aplicar estilo premium
      }
      return false;
    `
  },
  styles: {
    backgroundColor: order.status === "pending" ? "#ffebee" : "#e8f5e8",
    textColor: order.status === "pending" ? "#c62828" : "#2e7d32",
    icon: {
      name: order.status === "pending" ? "warning" : "star",
      position: "before"
    }
  }
};
```

### **Caso 2: RH - An√°lise de Funcion√°rios**

```typescript
// Regra Visual: Destacar funcion√°rios por performance e tempo de empresa
const employeeAnalysisRule = {
  name: "An√°lise de Funcion√°rios",
  condition: {
    dsl: `
      if (employee.performance >= 4.5 && employee.yearsInCompany >= 2) {
        return "high-performer";
      } else if (employee.performance < 3.0) {
        return "needs-attention";
      } else if (employee.yearsInCompany < 0.5) {
        return "new-hire";
      }
      return "standard";
    `
  },
  styleMapping: {
    "high-performer": {
      backgroundColor: "#e8f5e8",
      textColor: "#2e7d32",
      icon: { name: "star", color: "#fdd835" }
    },
    "needs-attention": {
      backgroundColor: "#ffebee",
      textColor: "#c62828",
      icon: { name: "warning", color: "#f57c00" }
    },
    "new-hire": {
      backgroundColor: "#e3f2fd",
      textColor: "#1976d2",
      icon: { name: "person_add", color: "#1976d2" }
    }
  }
};
```

### **Caso 3: Financeiro - An√°lise de Receitas**

```typescript
// Regra Visual: An√°lise de receita com m√∫ltiplos indicadores
const revenueAnalysisRule = {
  name: "An√°lise de Receita",
  condition: {
    dsl: `
      const monthlyTarget = 50000;
      const growthRate = (revenue.current - revenue.previous) / revenue.previous * 100;
      
      if (revenue.current >= monthlyTarget && growthRate > 10) {
        return "exceeding";
      } else if (revenue.current >= monthlyTarget) {
        return "on-target";
      } else if (growthRate > 0) {
        return "growing";
      } else {
        return "concerning";
      }
    `
  },
  dynamicStyles: {
    backgroundColor: `
      switch (ruleResult) {
        case "exceeding": return "#e8f5e8";
        case "on-target": return "#f3e5f5";
        case "growing": return "#fff3e0";
        default: return "#ffebee";
      }
    `,
    textColor: `
      switch (ruleResult) {
        case "exceeding": return "#2e7d32";
        case "on-target": return "#7b1fa2";
        case "growing": return "#ef6c00";
        default: return "#c62828";
      }
    `
  }
};
```

---

## üìä Templates Pr√©-definidos

### **Template 1: Status Simples**
```json
{
  "name": "Status Simples (0/1 ‚Üí Inativo/Ativo)",
  "description": "Converte c√≥digos num√©ricos em status leg√≠veis",
  "rules": [
    {
      "condition": "${value} == 0",
      "styles": {
        "backgroundColor": "#ffebee",
        "textColor": "#c62828"
      },
      "valueMapping": "Inativo"
    },
    {
      "condition": "${value} == 1", 
      "styles": {
        "backgroundColor": "#e8f5e8",
        "textColor": "#2e7d32"
      },
      "valueMapping": "Ativo"
    }
  ]
}
```

### **Template 2: Faixas de Valores**
```json
{
  "name": "Classifica√ß√£o por Faixas",
  "description": "Classifica valores num√©ricos em faixas",
  "rules": [
    {
      "condition": "${value} < 1000",
      "styles": { "backgroundColor": "#ffcdd2" },
      "valueMapping": "Baixo (${value})"
    },
    {
      "condition": "${value} >= 1000 && ${value} < 5000",
      "styles": { "backgroundColor": "#fff9c4" },
      "valueMapping": "M√©dio (${value})"
    },
    {
      "condition": "${value} >= 5000",
      "styles": { "backgroundColor": "#c8e6c9" },
      "valueMapping": "Alto (${value})"
    }
  ]
}
```

### **Template 3: An√°lise Temporal**
```json
{
  "name": "An√°lise de Datas",
  "description": "Destaca registros baseado em crit√©rios temporais",
  "rules": [
    {
      "condition": "daysBetween(${date}, now()) > 30",
      "styles": {
        "backgroundColor": "#ffebee",
        "icon": { "name": "schedule", "color": "#f44336" }
      },
      "valueMapping": "Vencido h√° ${daysBetween(${date}, now())} dias"
    },
    {
      "condition": "daysBetween(${date}, now()) > 7",
      "styles": {
        "backgroundColor": "#fff3e0",
        "icon": { "name": "warning", "color": "#ff9800" }
      },
      "valueMapping": "Aten√ß√£o: ${daysBetween(${date}, now())} dias"
    }
  ]
}
```

---

## üîÑ Fluxo de Trabalho Completo

### **1. Usu√°rio Configura Regra**
1. Abre editor de colunas
2. Seleciona coluna para configurar
3. Expande se√ß√£o "Regras Visuais"
4. Usa interface visual para criar regra
5. Visualiza preview em tempo real

### **2. Sistema Processa Regra**
1. **Valida√ß√£o**: Verifica sintaxe e l√≥gica da regra
2. **Compila√ß√£o**: Converte regra visual em fun√ß√£o JavaScript
3. **Cache**: Armazena fun√ß√£o compilada para performance
4. **Aplica√ß√£o**: Aplica regra aos dados da tabela

### **3. Resultado na Tabela**
1. **Renderiza√ß√£o**: Aplica estilos condicionais √†s c√©lulas
2. **Performance**: Usa cache para evitar recomputa√ß√£o
3. **Responsividade**: Atualiza estilos quando dados mudam
4. **Feedback**: Mostra indicadores visuais de regras ativas

---

## üìà M√©tricas de Sucesso

### **Performance**
- ‚ö° **Compila√ß√£o de regras**: < 100ms
- üöÄ **Aplica√ß√£o em 1000 linhas**: < 500ms  
- üíæ **Uso de mem√≥ria**: < 50MB para 10 regras complexas
- üîÑ **Cache hit rate**: > 90%

### **Usabilidade**
- üéØ **Tempo de configura√ß√£o**: 70% redu√ß√£o vs c√≥digo manual
- üë§ **Curva de aprendizado**: < 30min para usu√°rio t√©cnico
- ‚úÖ **Taxa de sucesso**: > 95% nas regras criadas
- üîÑ **Reutiliza√ß√£o**: > 80% das regras s√£o reutilizadas

### **Qualidade**
- üõ°Ô∏è **Valida√ß√£o**: 100% das regras s√£o validadas
- üêõ **Taxa de erro**: < 1% em produ√ß√£o
- üìä **Cobertura de testes**: > 95%
- üîç **An√°lise est√°tica**: 0 vulnerabilidades

---

## üöÄ Pr√≥ximos Passos

### **Implementa√ß√£o Imediata (Semana 1-2)**
1. ‚úÖ Implementar `TableRuleEngineService`
2. ‚úÖ Criar `StyleRuleBuilderComponent`  
3. ‚úÖ Desenvolver `StylePreviewComponent`
4. üî≤ Integrar no `columns-config-editor`

### **Funcionalidades Avan√ßadas (Semana 3-4)**
1. üî≤ Templates pr√©-definidos
2. üî≤ Advanced Value Mapping Editor
3. üî≤ Visibility Rule Builder
4. üî≤ Sistema de valida√ß√£o robusto

### **Otimiza√ß√£o e UX (Semana 5-6)**
1. üî≤ Performance optimization
2. üî≤ Documenta√ß√£o autom√°tica
3. üî≤ Import/Export de configura√ß√µes
4. üî≤ Testes automatizados

A integra√ß√£o do **praxis-visual-builder** com o **praxis-table-config-editor** representa um marco significativo na evolu√ß√£o das ferramentas de configura√ß√£o, proporcionando uma experi√™ncia visual e intuitiva para criar regras de neg√≥cio complexas sem necessidade de programa√ß√£o manual.